# Troubleshooting Guide

This guide provides solutions to common issues encountered while using Claude Code GitHub Actions. If you face a problem not covered here, please refer to the official documentation or seek support.

## 1. Claude Not Responding to `@claude` Commands

If Claude is not reacting to your `@claude` mentions in issue or pull request comments:

### Possible Causes & Solutions

*   **GitHub App Not Installed or Incorrectly Configured**:
    *   **Solution**: Verify that the Claude GitHub App is correctly installed in your repository. Check its permissions (should have read/write for `Contents`, `Issues`, `Pull requests`). Reinstall if necessary via [https://github.com/apps/claude](https://github.com/apps/claude) or `/install-github-app` in the CLI.
*   **Workflow Not Enabled or Incorrectly Triggered**:
    *   **Solution**: Ensure your workflow file (`.github/workflows/claude.yml`) is present, correctly named, and enabled in your repository's Actions tab. Check that the `on:` section includes `issue_comment: types: [created]` and `pull_request_review_comment: types: [created]`.
*   **`ANTHROPIC_API_KEY` Secret Missing or Incorrect**:
    *   **Solution**: Confirm that the `ANTHROPIC_API_KEY` secret is correctly set in your repository's `Settings > Secrets and variables > Actions`. Double-check for typos or leading/trailing spaces.
*   **Incorrect Trigger Phrase**:
    *   **Solution**: Ensure your comment explicitly contains the `trigger_phrase` (default: `@claude`). Note that `/claude` is not the default trigger. If you've customized `trigger_phrase` in your workflow, use that custom phrase.
*   **Conditional Logic (`if:`) Preventing Execution**:
    *   **Solution**: Review any `if:` conditions in your workflow job. Ensure they do not inadvertently prevent the job from running when a `@claude` mention occurs. For interactive mode, a common condition is `if: contains(github.event.comment.body, ' @claude')`.

## 2. CI Not Running on Claude's Commits

If your Continuous Integration (CI) workflows are not being triggered by commits made by Claude:

### Possible Causes & Solutions

*   **GitHub App vs. `GITHUB_TOKEN`**:
    *   **Solution**: By default, `GITHUB_TOKEN` does not trigger workflows to prevent recursive runs. Ensure Claude is making commits using a token generated by a **GitHub App** (either the official Claude App or your custom app) rather than the default `GITHUB_TOKEN`. The `actions/create-github-app-token` action is used for this.
*   **Workflow Trigger Configuration**:
    *   **Solution**: Check your CI workflow's `on:` triggers. If it's only listening for `push` events, ensure it's configured to also listen for `pull_request` events or other relevant events that might be triggered by the GitHub App.
*   **App Permissions**:
    *   **Solution**: Verify that your GitHub App has sufficient permissions to trigger CI workflows. This typically involves `contents: write` and potentially other permissions depending on your CI setup.

## 3. Authentication Errors

Authentication failures can occur with any of the supported Claude API providers.

### Possible Causes & Solutions

*   **Invalid or Expired API Key (Direct Anthropic API)**:
    *   **Solution**: Regenerate your `ANTHROPIC_API_KEY` from the Anthropic Console and update the GitHub secret.
*   **Incorrect Cloud Provider Credentials (AWS Bedrock / Google Vertex AI)**:
    *   **Solution**:
        *   **AWS Bedrock**: Verify that `AWS_ROLE_TO_ASSUME` is correct, the IAM role exists, its trust policy allows GitHub's OIDC provider, and the role has `AmazonBedrockFullAccess` (or equivalent) permissions. Ensure `id-token: write` is set in your workflow permissions.
        *   **Google Vertex AI**: Confirm `GCP_WORKLOAD_IDENTITY_PROVIDER` and `GCP_SERVICE_ACCOUNT` secrets are correct. Check that the Workload Identity Pool, OIDC provider, and service account are correctly configured in GCP, and the service account has `Vertex AI User` role. Ensure `id-token: write` is set in your workflow permissions.
*   **GitHub App Token Generation Failure**:
    *   **Solution**: If using a custom GitHub App, ensure `APP_ID` and `APP_PRIVATE_KEY` secrets are correct. Verify the `actions/create-github-app-token` step is successful and generates a valid token. Check the GitHub App's permissions.
*   **Network Issues**:
    *   **Solution**: While less common, temporary network issues can cause authentication failures. Retrying the workflow might resolve the issue.

## 4. Unexpected Behavior or Errors

For general unexpected behavior, consider these steps:

*   **Review Workflow Logs**: The GitHub Actions workflow logs are your primary source of information. Look for error messages, stack traces, or warnings.
*   **Enable Debugging**: Add `--debug` to `claude_args` to get more verbose output from the Claude Code Action, which can help pinpoint the problem.
*   **Check `CLAUDE.md`**: Ensure your `CLAUDE.md` file is not inadvertently guiding Claude into incorrect actions or conflicting instructions.
*   **Tool Permissions**: If Claude is failing to perform an action, it might be due to insufficient tool permissions. Review your `allowed_tools` and `disallowed_tools` configurations.
*   **Model Context Protocol (MCP) Issues**: If using custom MCP servers, ensure they are correctly configured, running, and their tools are properly exposed and allowed. Check the logs of the MCP server itself if possible.
*   **Rate Limits**: Excessive API calls might hit rate limits. Check the Claude API documentation for rate limits and consider optimizing your workflow to reduce call frequency or use exponential backoff for retries.
*   **Timeouts**: If workflows are timing out, consider increasing `timeout-minutes` in your workflow or `claude_args: "--timeout <seconds>"` for Claude's internal operations.

By systematically checking these areas, you can diagnose and resolve most issues with Claude Code GitHub Actions.
